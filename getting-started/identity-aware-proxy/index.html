<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-464018-9"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-464018-9');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=xQdjvJ8Lmw"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=xQdjvJ8Lmw"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=xQdjvJ8Lmw"><link rel=manifest href="/site.webmanifest?v=xQdjvJ8Lmw"><link rel=mask-icon href="/safari-pinned-tab.svg?v=xQdjvJ8Lmw" color=#28a745><link rel="shortcut icon" href="/favicon.ico?v=xQdjvJ8Lmw"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><title>Identity Aware Proxy (IAP) &ndash; Estafette CI/CD</title><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://estafette.io/sass/estafette.min.7f9f3ad31f44302446582e482cb18d648864a1d57e5e96611384029e40696adb.css integrity="sha256-f5860x9EMCRGWC5ILLGNZIhkodV+XpZhE4QCnkBpats="></head><body><div id=header-and-main><nav class="navbar navbar-dark bg-dark navbar-expand-md"><a href=/ class="navbar-brand text-white mr-3 router-link-exact-active active" target=_self><svg style="width:1.25em;overflow:visible;vertical-align:-2.5px" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="shipping-fast" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="m-0 ml-2 mr-2 h5 svg-inline--fa fa-shipping-fast fa-w-20"><path fill="currentcolor" d="M624 352h-16V243.9c0-12.7-5.1-24.9-14.1-33.9L494 110.1c-9-9-21.2-14.1-33.9-14.1H416V48c0-26.5-21.5-48-48-48H112C85.5.0 64 21.5 64 48v48H8c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h272c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H40c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h208c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H8c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h208c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H64v128c0 53 43 96 96 96s96-43 96-96h128c0 53 43 96 96 96s96-43 96-96h48c8.8.0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zM160 464c-26.5.0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm320 0c-26.5.0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-208H416V144h44.1l99.9 99.9V256z"/></svg><em class=align-top>Estafette</em></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNavAltMarkup aria-controls=navbarNavAltMarkup aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavAltMarkup><div class=navbar-nav><a class="nav-item nav-link active" href=/getting-started/>Getting started</a><a class="nav-item nav-link" href=/usage/>Usage</a><a class="nav-item nav-link" href=/security/>Security</a><a class="nav-item nav-link" href=/design/>Design</a><a class="nav-item nav-link" href=/screenshots/>Screenshots</a></div></div></nav><div id=main><div class=container-fluid><div class="row mt-4 mb-4"><div class="col d-none d-md-flex border-right sidebar sticky-top"><ul><li class=section-item><a href=/getting-started/ class="section-item-link ancestor">Getting started</a><ul><li class=page-item><a href=/getting-started/installation/ class=page-item-link>Installation</a></li><li class=section-item><a href=/getting-started/tls-certmanager/ class=section-item-link>TLS with certmanager</a></li><li class=section-item><a href=/getting-started/tls-estafette-letsencrypt/ class=section-item-link>TLS with estafette controller</a></li><li class=section-item><a href=/getting-started/github-login/ class=section-item-link>Github login</a></li><li class=section-item><a href=/getting-started/google-login/ class=section-item-link>Google login</a></li><li class=section-item><a href=/getting-started/bitbucket-integration/ class=section-item-link>Bitbucket integration</a></li><li class=section-item><a href=/getting-started/github-integration/ class=section-item-link>Github integration</a></li><li class=section-item><a href=/getting-started/production-high-availability/ class=section-item-link>Production / High Availability</a></li><li class=section-item><a href=/getting-started/identity-aware-proxy/ class="section-item-link ancestor active">Identity Aware Proxy (IAP)</a></li><li class=page-item><a href=/getting-started/configuration/ class=page-item-link>Other configuration</a></li></ul></li><li class=section-item><a href=/usage/ class=section-item-link>Usage</a></li><li class=section-item><a href=/security/ class=section-item-link>Security</a></li><li class=section-item><a href=/design/ class=section-item-link>Design</a></li><li class=section-item><a href=/screenshots/ class=section-item-link>Screenshots</a></li></ul></div><div class="col pl-5 pt-4 content-block"><div class=row><article class="col section-intro"><header><h1 class=mb-4>Identity Aware Proxy (IAP)</h1></header><p>For using <em>Estafette CI</em> at your company you probably want to keep the web interface to be private and only accessible to your employees. One way to do that is to run it behind <em>Identity Aware Proxy</em> (IAP) if you're on Google Cloud. This makes it accessible based on the user's identity, instead of relying on a less secure or less friendly option like VPN.</p><h1 id=creating-oauth-credentials>Creating OAuth credentials</h1><p>You might have already followed the instructions on how to set up <a href=/getting-started/google-login/>Google login</a>, otherwise do that first. Once done go back to the credentials page in the Google Cloud Console.</p><p>There you have to add an additional <em>Authorized redirect URI</em> of the form:</p><pre><code>https://iap.googleapis.com/v1/oauth/clientIds/&lt;client id&gt;:handleRedirect
</code></pre><p>Where you'll use the <em>Client ID</em> visible on the same page for the value of <code>&lt;client id></code>.</p><h1 id=configure-helm-values>Configure Helm values</h1><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>api:
  iap:
    enabled: <span style=color:#00f>true</span>
    clientId: <span style=color:#5a2>&#39;***.apps.googleusercontent.com&#39;</span>
    clientSecret: <span style=color:#5a2>&#39;***&#39;</span>
api:
  web:
    enabled: <span style=color:#00f>true</span>
    clientId: <span style=color:#5a2>&#39;***.apps.googleusercontent.com&#39;</span>
    clientSecret: <span style=color:#5a2>&#39;***&#39;</span>
</code></pre></div><h1 id=permissions-for-iap>Permissions for IAP</h1><p>After applying the new values you'll have to set up the access rule for the <em>Identity Aware Proxy</em>; You can do so in the <em>Google Cloud Console</em> at <a href=https://console.cloud.google.com/security/iap>https://console.cloud.google.com/security/iap</a>.</p><p>First select the <code>estafette-ci/estafette-ci-api</code> backend service and click <em>Add principal</em> in the right info pane. You want to add either your organization or groups, rather than individuals to automatically have new joiners be able to access the system. Add them in the <em>new principals</em> field and then select role <em>Cloud IAP > IAP-Secured Web App User</em>. Repeat this for the <code>estafette-ci/estafette-ci-web</code> backend service. Now it's a matter of minutes before the base host address of the <em>Estafette CI</em> installation is accessible through IAP.</p></article></div><div class=row style=max-width:1024px></div></div><div class="col d-none d-xl-flex border-left toc sticky-top"><ul><li class=section-item><a class="section-item-link ancestor">Table of contents</a><li class=page-item><a href=/getting-started/identity-aware-proxy/#creating-oauth-credentials title="Creating OAuth credentials" class=page-item-link>Creating OAuth credentials</a><li class=page-item><a href=/getting-started/identity-aware-proxy/#configure-helm-values title="Configure Helm values" class=page-item-link>Configure Helm values</a><li class=page-item><a href=/getting-started/identity-aware-proxy/#permissions-for-iap title="Permissions for IAP" class=page-item-link>Permissions for IAP</a></li></ul></div></div></div></div></div><nav class="footer nav justify-content-end bg-dark p-2"><a href=https://github.com/estafette/estafette-ci-central target=_blank class="nav-link text-light">Github</a></nav><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script></body></html>