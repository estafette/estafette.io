<!doctype html><html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-464018-9"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-464018-9')</script>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=xQdjvJ8Lmw">
<link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=xQdjvJ8Lmw">
<link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=xQdjvJ8Lmw">
<link rel=manifest href="/site.webmanifest?v=xQdjvJ8Lmw">
<link rel=mask-icon href="/safari-pinned-tab.svg?v=xQdjvJ8Lmw" color=#28a745>
<link rel="shortcut icon" href="/favicon.ico?v=xQdjvJ8Lmw">
<meta name=msapplication-TileColor content="#ffffff">
<meta name=theme-color content="#ffffff">
<title>
Best practices &ndash; Estafette CI/CD
</title>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous>
<link rel=stylesheet href=https://estafette.io/sass/estafette.min.7f9f3ad31f44302446582e482cb18d648864a1d57e5e96611384029e40696adb.css integrity="sha256-f5860x9EMCRGWC5ILLGNZIhkodV+XpZhE4QCnkBpats=">
</head>
<body>
<div id=header-and-main>
<nav class="navbar navbar-dark bg-dark navbar-expand-md">
<a href=/ class="navbar-brand text-white mr-3 router-link-exact-active active" target=_self><svg style="width:1.25em;overflow:visible;vertical-align:-2.5px" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="shipping-fast" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="m-0 ml-2 mr-2 h5 svg-inline--fa fa-shipping-fast fa-w-20"><path fill="currentcolor" d="M624 352h-16V243.9c0-12.7-5.1-24.9-14.1-33.9L494 110.1c-9-9-21.2-14.1-33.9-14.1H416V48c0-26.5-21.5-48-48-48H112C85.5.0 64 21.5 64 48v48H8c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h272c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H40c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h208c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H8c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h208c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H64v128c0 53 43 96 96 96s96-43 96-96h128c0 53 43 96 96 96s96-43 96-96h48c8.8.0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zM160 464c-26.5.0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm320 0c-26.5.0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-208H416V144h44.1l99.9 99.9V256z"/></svg>
<em class=align-top>Estafette</em>
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNavAltMarkup aria-controls=navbarNavAltMarkup aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarNavAltMarkup>
<div class=navbar-nav>
<a class="nav-item nav-link" href=/getting-started/>Getting started</a><a class="nav-item nav-link active" href=/usage/>Usage</a><a class="nav-item nav-link" href=/security/>Security</a><a class="nav-item nav-link" href=/design/>Design</a><a class="nav-item nav-link" href=/screenshots/>Screenshots</a></div>
</div>
</nav>
<div id=main>
<div class=container-fluid>
<div class="row mt-4 mb-4">
<div class="col d-none d-md-flex border-right sidebar sticky-top">
<ul><li class=section-item><a href=/getting-started/ class=section-item-link>Getting started</a>
</li><li class=section-item><a href=/usage/ class="section-item-link ancestor">Usage</a><ul><li class=page-item><a href=/usage/manifest/ class=page-item-link>Manifest</a></li><li class=section-item><a href=/usage/extensions/ class=section-item-link>Extensions</a>
</li><li class=page-item><a href=/usage/best-practices/ class="page-item-link active">Best practices</a></li><li class=page-item><a href=/usage/examples/ class=page-item-link>Examples</a></li>
</ul>
</li><li class=section-item><a href=/security/ class=section-item-link>Security</a>
</li><li class=section-item><a href=/design/ class=section-item-link>Design</a>
</li><li class=section-item><a href=/screenshots/ class=section-item-link>Screenshots</a>
</li></ul>
</div>
<div class="col pl-5 pr-5 pt-4 content-block">
<h1 class=mb-4>Best practices</h1>
<h3 id=pin-image-tags>Pin image tags</h3>
<p>In order to keep your builds reproducible, even if you haven&rsquo;t touched them for a year it&rsquo;s best to pin the stage image tags as narrowly as possible (or at least major and minor to avoid adopting breaking changes). This will ensure you&rsquo;re not wasting a day figuring out why your build is suddenly broken, when it turns out it&rsquo;s the latest image tag of one of the used images is actually a different image now.</p>
<div class=dont>
<p><strong class=text-danger>DON'T:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
  <span style=color:#000>build</span>:
    <span style=color:#000>image</span>: golang
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
  <span style=color:#000>build</span>:
    <span style=color:#000>image</span>: golang:latest
</code></pre></div>
</div>
<div class=do>
<p><strong class=text-success>DO:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
  <span style=color:#000>build</span>:
    <span style=color:#000>image</span>: golang:1.11.2-alpine3.8
</code></pre></div>
</div>
<h3 id=use-commands-instead-of-build-scripts>Use commands instead of build scripts</h3>
<p>One of the strengths of <em>Estafette</em>&rsquo;s manifest is that you can immediately see which commands have been issued and can try those on your own machine. This particularly comes in handy when your build breaks. If the actual commands are hidden in a build script you have to navigate from repository to repository to find which commands are actually executed and it means more work to fix things in that case.</p>
<div class=dont>
<p><strong class=text-danger>DON'T:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
  <span style=color:#000>build</span>:
    <span style=color:#000>image</span>: microsoft/dotnet:2.1-sdk
    <span style=color:#000>commands</span>:
    - build-script.sh
</code></pre></div>
</div>
<div class=do>
<p><strong class=text-success>DO:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
    <span style=color:#000>image</span>: microsoft/dotnet:2.1-sdk
    <span style=color:#000>commands</span>:
    - dotnet build --configuration Release /p:Version=${ESTAFETTE_BUILD_VERSION} --no-restore
</code></pre></div>
</div>
<h3 id=share-as-little-as-possible-between-applications>Share as little as possible between applications</h3>
<p>Although it&rsquo;s tempting to build your own fat <em>builder</em> images to run your steps (particularly to improve speed), before you know it a dozen applications rely on this particular image. When you by accident break the image all the builds using it can no longer build. Or you remove an installed depedency because your particular build no longer use it, turns out a bunch of other applications actually do use it.</p>
<div class=dont>
<p><strong class=text-danger>DON'T:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
  <span style=color:#000>build</span>:
    <span style=color:#000>image</span>: myrepo/myown-cloud-sdk
    <span style=color:#000>commands</span>:
    - ...
</code></pre></div>
</div>
<div class=do>
<p><strong class=text-success>DO:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
    <span style=color:#000>image</span>: google/cloud-sdk:223.0.0-alpine
    <span style=color:#000>commands</span>:
    - apk add gettext
    - gcloud commands install kubectl
    - ...
</code></pre></div>
</div>
<h3 id=avoid-using-estafettes-dev-or-beta-tags>Avoid using Estafette&rsquo;s dev or beta tags</h3>
<p><em>Estafette</em> dogfoods it&rsquo;s own components, pushing new versions to the <code>dev</code> tag first. Once it&rsquo;s confirmed to be functional it gets promoted to beta, then to stable. Because the dev tag of any extension can be broken at any time avoid using it and use the <code>stable</code> tag instead.</p>
<div class=dont>
<p><strong class=text-danger>DON'T:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
  <span style=color:#000>build</span>:
    <span style=color:#000>image</span>: extensions/docker:dev
</code></pre></div>
</div>
<div class=do>
<p><strong class=text-success>DO:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>stages</span>:
  <span style=color:#000>build</span>:
    <span style=color:#000>image</span>: extensions/docker:stable
</code></pre></div>
</div>
<h3 id=avoid-using-estafettes-builder-dev-track>Avoid using Estafette&rsquo;s builder dev track</h3>
<p><em>Estafette</em> dogfoods it&rsquo;s own components, pushing new versions to the <code>dev</code> track first. Once it&rsquo;s confirmed to be functional it gets promoted to beta, then to stable. Because the dev track of the builder itself can be broken at any time avoid using it and use the <code>stable</code> track instead.</p>
<div class=dont>
<p><strong class=text-danger>DON'T:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>builder</span>:
  <span style=color:#000>track</span>: dev
</code></pre></div>
</div>
<div class=do>
<p><strong class=text-success>DO:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>builder</span>:
  <span style=color:#000>track</span>: stable
</code></pre></div><p>Or drop the <code>builder</code> section alltogether, it defaults to the stable track.</p>
</div>
<h3 id=use-pipeline-restricted-secrets-instead-of-global-secrets>Use pipeline restricted secrets instead of global secrets</h3>
<p>In Estafette you can create <em>global</em> secrets which can be decrypted by any pipeline and <em>restricted</em> secrets which can only be used in a single pipeline. In your <code>.estafette.yaml</code> manifest it&rsquo;s best to only use pipeline <em>restricted</em> secrets.</p>
<p>You can distinguish between the two types by the number of dots in the <code>estafette.secret(...)</code> envelope. A <em>global</em> secret use one dot to separate the nonce from the encrypted value; a <em>restricted</em> secret has two dots separating the nonce, the encrypted value and the pipeline regex.</p>
<div class=dont>
<p><strong class=text-danger>DON'T:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>env</span>:
  <span style=color:#000>MY_GLOBAL_SECRET</span>: estafette.secret(deFTz5Bdjg6SUe29.oPIkXbze5G9PNEWS2-ZnArl8BCqHnx4MdTdxHg37th9u)
</code></pre></div><p>Global secrets were originally the only type of secret, but now they should only be used in Estafette&rsquo;s centrally stored credentials, which can then be reused by any pipeline using trusted images that get those credentials injected.</p>
</div>
<div class=do>
<p><strong class=text-success>DO:</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#000>env</span>:
  <span style=color:#000>MY_PIPELINE_RESTRICTED_SECRET</span>: estafette.secret(7pB-Znp16my5l-Gz.l--UakUaK5N8KYFt-sVNUaOY5uobSpWabJNVXYDEyDWT.hO6JcRARdtB-PY577NJeUrKMVOx-sjg617wTd8IkAh-PvIm9exuATeDeFiYaEr9eQtfreBQ=)
</code></pre></div><p>When replacing a <em>global</em> secret with a <em>restricted</em> secret make sure to rotate the encrypted value itself - i.e. database password, api key, etc - in order to prevent anyone from using the former <em>global</em> secret to gain access to the protected system. The <em>restricted</em> secret can be generated in the pipeline&rsquo;s secrets tab.</p>
</div>
</div>
<div class="col d-none d-xl-flex border-left toc sticky-top">
<ul>
<li class=section-item><a class="section-item-link ancestor">Table of contents</a>
<ul>
<li class=page-item>
<a href=/usage/best-practices/#pin-image-tags title="Pin image tags" class=page-item-link>
Pin image tags
</a>
<li class=page-item>
<a href=/usage/best-practices/#use-commands-instead-of-build-scripts title="Use commands instead of build scripts" class=page-item-link>
Use commands instead of build scripts
</a>
<li class=page-item>
<a href=/usage/best-practices/#share-as-little-as-possible-between-applications title="Share as little as possible between applications" class=page-item-link>
Share as little as possible between applications
</a>
<li class=page-item>
<a href=/usage/best-practices/#avoid-using-estafettes-dev-or-beta-tags title="Avoid using Estafette’s dev or beta tags" class=page-item-link>
Avoid using Estafette’s dev or beta tags
</a>
<li class=page-item>
<a href=/usage/best-practices/#avoid-using-estafettes-builder-dev-track title="Avoid using Estafette’s builder dev track" class=page-item-link>
Avoid using Estafette’s builder dev track
</a>
<li class=page-item>
<a href=/usage/best-practices/#use-pipeline-restricted-secrets-instead-of-global-secrets title="Use pipeline restricted secrets instead of global secrets" class=page-item-link>
Use pipeline restricted secrets instead of global secrets
</a>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<nav class="footer nav justify-content-end bg-dark p-2">
<a href=https://github.com/estafette/estafette-ci-central target=_blank class="nav-link text-light">Github</a>
</nav>
<script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
</body>
</html>