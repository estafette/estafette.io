<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-464018-9"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-464018-9');</script><meta charset=utf-8><title>Best practices &ndash; Estafette CI/CD</title><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css integrity=sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB crossorigin=anonymous><link rel=stylesheet href=https://estafette.io/sass/estafette.min.86008a65857ee2b8a359716a76c00cefd74a250caefdbfe44e98dd0a865a03d4.css integrity="sha256-hgCKZYV&#43;4rijWXFqdsAM79dKJQyu/b/kTpjdCoZaA9Q="></head><body><div id=header-and-main><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><a class=navbar-brand href=/>Estafette CI</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNavAltMarkup aria-controls=navbarNavAltMarkup aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavAltMarkup><div class=navbar-nav><a class="nav-item nav-link" href=/getting-started/>Getting started</a><a class="nav-item nav-link active" href=/usage/>Usage</a><a class="nav-item nav-link" href=/design/>Design</a></div></div></nav><div id=main><div class=container-fluid><div class=row><div class="col mt-4 mb-4 border-right sidebar"><ul><li class=section-item><a href=/getting-started/ class=section-item-link>Getting started</a></li><li class=section-item><a href=/usage/ class="section-item-link ancestor">Usage</a><ul><li class=page-item><a href=/usage/manifest/ class=page-item-link>Manifest</a></li><li class=section-item><a href=/usage/extensions/ class=section-item-link>Extensions</a></li><li class=page-item><a href=/usage/best-practices/ class="page-item-link active">Best practices</a></li><li class=page-item><a href=/usage/examples/ class=page-item-link>Examples</a></li></ul></li><li class=section-item><a href=/design/ class=section-item-link>Design</a></li></ul></div><div class="col mt-4 mb-4 pl-5 pr-5 pt-4 content-block"><h1 class=mb-4>Best practices</h1><h3 id=pin-image-tags>Pin image tags</h3><p>In order to keep your builds reproducible, even if you haven&rsquo;t touched them for a year it&rsquo;s best to pin the stage image tags as narrowly as possible (or at least major and minor to avoid adopting breaking changes). This will ensure you&rsquo;re not wasting a day figuring out why your build is suddenly broken, when it turns out it&rsquo;s the latest image tag of one of the used images is actually a different image now.</p><div class=dont><p><strong class=text-danger>DON'T:</strong></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>stages:
  build:
    image: golang</code></pre></div><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>stages:
  build:
    image: golang:latest</code></pre></div></div><div class=do><p><strong class=text-success>DO:</strong></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>stages:
  build:
    image: golang:<span style=color:#3af>1.11</span>.<span style=color:#3af>2</span>-alpine3.<span style=color:#3af>8</span></code></pre></div><h3 id=use-commands-instead-of-build-scripts>Use commands instead of build scripts</h3><p>One of the strengths of Estafette&rsquo;s manifest is that you can immediately see which commands have been issued and can try those on your own machine. This particularly comes in handy when your build breaks. If the actual commands are hidden in a build script you have to navigate from repository to repository to find which commands are actually executed and it means more work to fix things in that case.</p><div class=dont><p><strong class=text-danger>DON'T:</strong></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>stages:
  build:
    image: microsoft/dotnet:<span style=color:#3af>2.1</span>-sdk
    commands:
    - build-script.sh</code></pre></div></div><div class=do><p><strong class=text-success>DO:</strong></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>stages:
    image: microsoft/dotnet:<span style=color:#3af>2.1</span>-sdk
    commands:
    - dotnet build --configuration Release /p:Version=${ESTAFETTE_BUILD_VERSION} --no-restore</code></pre></div><h3 id=share-as-little-as-possible-between-applications>Share as little as possible between applications</h3><p>Although it&rsquo;s tempting to build your own fat <em>builder</em> images to run your steps (particularly to improve speed), before you know it a dozen applications rely on this particular image. When you by accident break the image all the builds using it can no longer build. Or you remove an installed depedency because your particular build no longer use it, turns out a bunch of other applications actually do use it.</p><div class=dont><p><strong class=text-danger>DON'T:</strong></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>stages:
  build:
    image: myrepo/myown-cloud-sdk
    commands:
    - ...</code></pre></div></div><div class=do><p><strong class=text-success>DO:</strong></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>stages:
    image: google/cloud-sdk:<span style=color:#3af>223.0</span>.<span style=color:#3af>0</span>-alpine
    commands:
    - apk add gettext
    - gcloud commands install kubectl
    - ...</code></pre></div></div><p></div></p></div></div></div></div></div></div><nav class="footer nav justify-content-end bg-dark p-2"><a href=https://github.com/estafette/estafette-ci-central target=_blank class="nav-link text-light">Github</a></nav></body></html>