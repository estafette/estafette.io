<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-464018-9"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-464018-9');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=xQdjvJ8Lmw"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=xQdjvJ8Lmw"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=xQdjvJ8Lmw"><link rel=manifest href="/site.webmanifest?v=xQdjvJ8Lmw"><link rel=mask-icon href="/safari-pinned-tab.svg?v=xQdjvJ8Lmw" color=#28a745><link rel="shortcut icon" href="/favicon.ico?v=xQdjvJ8Lmw"><meta name=msapplication-TileColor content=#ffffff><meta name=theme-color content=#ffffff><title>Architecture &ndash; Estafette CI/CD</title><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://estafette.io/sass/estafette.min.daa8667c18dee5e14fbeec902662f83d41f9ce67e357f6a246d8e42655fab315.css integrity="sha256-2qhmfBje5eFPvuyQJmL4PUH5zmfjV/aiRtjkJlX6sxU="></head><body><div id=header-and-main><nav class="navbar navbar-dark bg-dark navbar-expand-md"><a href=/ class="navbar-brand text-white mr-3 router-link-exact-active active" target=_self><svg style="width:1.25em;overflow:visible;vertical-align:-2.5px" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="shipping-fast" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="m-0 ml-2 mr-2 h5 svg-inline--fa fa-shipping-fast fa-w-20"><path fill="currentcolor" d="M624 352h-16V243.9c0-12.7-5.1-24.9-14.1-33.9L494 110.1c-9-9-21.2-14.1-33.9-14.1H416V48c0-26.5-21.5-48-48-48H112C85.5.0 64 21.5 64 48v48H8c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h272c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H40c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h208c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H8c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h208c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H64v128c0 53 43 96 96 96s96-43 96-96h128c0 53 43 96 96 96s96-43 96-96h48c8.8.0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zM160 464c-26.5.0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm320 0c-26.5.0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-208H416V144h44.1l99.9 99.9V256z"/></svg><em class=align-top>Estafette</em></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNavAltMarkup aria-controls=navbarNavAltMarkup aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavAltMarkup><div class=navbar-nav><a class="nav-item nav-link" href=/getting-started/>Getting started</a><a class="nav-item nav-link" href=/usage/>Usage</a><a class="nav-item nav-link active" href=/design/>Design</a><a class="nav-item nav-link" href=/screenshots/>Screenshots</a></div></div></nav><div id=main><div class=container-fluid><div class="row mt-4 mb-4"><div class="col d-none d-md-flex border-right sidebar sticky-top"><ul><li class=section-item><a href=/getting-started/ class=section-item-link>Getting started</a></li><li class=section-item><a href=/usage/ class=section-item-link>Usage</a></li><li class=section-item><a href=/design/ class="section-item-link ancestor">Design</a><ul><li class=page-item><a href=/design/goals/ class=page-item-link>Goals</a></li><li class=page-item><a href=/design/architecture/ class="page-item-link active">Architecture</a></li></ul></li><li class=section-item><a href=/screenshots/ class=section-item-link>Screenshots</a></li></ul></div><div class="col pl-5 pr-5 pt-4 content-block"><h1 class=mb-4>Architecture</h1><p>The high-level architecture of Estafette CI looks as follows:</p><p><img src=/design/architecture.png alt="Architecture overview"></p><h2 id=components>Components</h2><h4 id=api>API</h4><p>In Estafette CI the api layer is at the heart of the system. It receives events from integrations from the build and release jobs and some other components. The API itself is stateless and runs multiple pods for high availability. It can be upgraded without downtime.</p><h4 id=web>Web</h4><p>The web frontend is a single page application written in VueJS interfacing with the API for it&rsquo;s content.</p><h4 id=build-release-jobs>Build / release jobs</h4><p>When a build or release is started due to an event being received by the API it is the API itself that creates a build job via the Kubernetes API. It uses the <em>Job</em> resource type, so Kubernetes takes care of jobs failing due to nodes getting deleted. Inside the job the <em>estafette-ci-builder</em> runs the stages defined in the <code>.estafette.yaml</code> manifest. Any failure in running the stages is reported to the API, but the Kubernetes job itself still succeeds so it doesn&rsquo;t get restarted.</p><p>The job can run to completion independently of API upgrades happening in the meantime making it a resilient system that can be upgraded at all times.</p><p>When the <em>estafette-ci-builder</em> gets updated in the mean time it doesn&rsquo;t affect running builds, only new ones started after is has been updated.</p><h4 id=database>Database</h4><p>For being able to scale and perform well Estafette is built on top of the cloud-native distributed SQL database <a href=https://www.cockroachlabs.com/>CockroachDB</a>. It can scale along with the number of pipelines, build jobs and release jobs running on your setup, so it can easily handle hundreds of pipelines and tens of thousands of builds without slowing down.</p><p>It also makes it possible to upgrade the database itself without any downtime, which is an important feature for Estafette, to always be online.</p><p>Currently the most important data stored in the database are the autoincrementing build number per pipeline and all the build and release logs.</p><h4 id=cron-timer>Cron timer</h4><p>This component uses a Kubernetes CronJob to fire a <em>tick</em> event to the API layer every minute, which allows cron triggers to function without the API layer having to run timed events in the background itself.</p><h2 id=languages>Languages</h2><p>All Estafette components - except for the web UI - are built in golang, to make use of it&rsquo;s low cpu and memory usage, it&rsquo;s speed of starting up new containers and it&rsquo;s ease of building it for many platforms.</p></div><div class="col d-none d-xl-flex border-left toc sticky-top"><ul><li class=section-item><a class="section-item-link ancestor">Table of contents</a><ul><li class=page-item><a href=/design/architecture/#components title=Components class=page-item-link>Components</a><ul><li class=page-item><a href=/design/architecture/#api title=API class=page-item-link>API</a><li class=page-item><a href=/design/architecture/#web title=Web class=page-item-link>Web</a><li class=page-item><a href=/design/architecture/#build-release-jobs title="Build / release jobs" class=page-item-link>Build / release jobs</a><li class=page-item><a href=/design/architecture/#database title=Database class=page-item-link>Database</a><li class=page-item><a href=/design/architecture/#cron-timer title="Cron timer" class=page-item-link>Cron timer</a></ul><li class=page-item><a href=/design/architecture/#languages title=Languages class=page-item-link>Languages</a></ul></li></ul></div></div></div></div></div><nav class="footer nav justify-content-end bg-dark p-2"><a href=https://github.com/estafette/estafette-ci-central target=_blank class="nav-link text-light">Github</a></nav><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script></body></html>