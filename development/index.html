<!doctype html><html><head><script async src="https://www.googletagmanager.com/gtag/js?id=UA-464018-9"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-464018-9');</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=xQdjvJ8Lmw"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=xQdjvJ8Lmw"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=xQdjvJ8Lmw"><link rel=manifest href="/site.webmanifest?v=xQdjvJ8Lmw"><link rel=mask-icon href="/safari-pinned-tab.svg?v=xQdjvJ8Lmw" color=#28a745><link rel="shortcut icon" href="/favicon.ico?v=xQdjvJ8Lmw"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><title>Development &ndash; Estafette CI/CD</title><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous><link rel=stylesheet href=https://estafette.io/sass/estafette.min.7f9f3ad31f44302446582e482cb18d648864a1d57e5e96611384029e40696adb.css integrity="sha256-f5860x9EMCRGWC5ILLGNZIhkodV+XpZhE4QCnkBpats="></head><body><div id=header-and-main><nav class="navbar navbar-dark bg-dark navbar-expand-md"><a href=/ class="navbar-brand text-white mr-3 router-link-exact-active active" target=_self><svg style="width:1.25em;overflow:visible;vertical-align:-2.5px" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="shipping-fast" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="m-0 ml-2 mr-2 h5 svg-inline--fa fa-shipping-fast fa-w-20"><path fill="currentcolor" d="M624 352h-16V243.9c0-12.7-5.1-24.9-14.1-33.9L494 110.1c-9-9-21.2-14.1-33.9-14.1H416V48c0-26.5-21.5-48-48-48H112C85.5.0 64 21.5 64 48v48H8c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h272c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H40c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h208c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H8c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h208c4.4.0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H64v128c0 53 43 96 96 96s96-43 96-96h128c0 53 43 96 96 96s96-43 96-96h48c8.8.0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zM160 464c-26.5.0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm320 0c-26.5.0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-208H416V144h44.1l99.9 99.9V256z"/></svg><em class=align-top>Estafette</em></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNavAltMarkup aria-controls=navbarNavAltMarkup aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavAltMarkup><div class=navbar-nav><a class="nav-item nav-link" href=/getting-started/>Getting started</a><a class="nav-item nav-link" href=/usage/>Usage</a><a class="nav-item nav-link" href=/design/>Design</a><a class="nav-item nav-link active" href=/development/>Development</a></div></div></nav><div id=main><div class=container-fluid><div class="row mt-4 mb-4"><div class="col d-none d-md-flex border-right sidebar sticky-top"><ul><li class=section-item><a href=/getting-started/ class=section-item-link>Getting started</a></li><li class=section-item><a href=/usage/ class=section-item-link>Usage</a></li><li class=section-item><a href=/design/ class=section-item-link>Design</a></li><li class=section-item><a href=/development/ class="section-item-link ancestor active">Development</a></li></ul></div><div class="col pl-5 pt-4 content-block"><div class=row><article class="col section-intro"><header><h1 class=mb-4>Development</h1></header><h3 id=introduction>Introduction</h3><p><em>Estafette CI</em> installation is always done using the Helm chart. This also has consequences for how you can contribute and test your changes. And finally how new versions are released.</p><h3 id=development>Development</h3><p>The following components are used from the <em>subcharts</em> of the <code>estafette-ci</code> chart. Together they form the <em>Estafette CI</em> platform.</p><table><thead><tr><th>Component</th><th>Purpose</th><th>Repository</th></tr></thead><tbody><tr><td><code>estafette-ci</code></td><td>Umbrella Helm chart to install all of the following resources</td><td><a href=https://github.com/estafette/estafette-ci>https://github.com/estafette/estafette-ci</a></td></tr><tr><td><code>estafette-ci-api</code></td><td>API to handle web component requests, github/bitbucket webhooks, spawn pipeline jobs, etc</td><td><a href=https://github.com/estafette/estafette-ci-api>https://github.com/estafette/estafette-ci-api</a></td></tr><tr><td><code>estafette-ci-web</code></td><td>Web user interface to see pipeline builds, releases, logs and trigger manual releases</td><td><a href=https://github.com/estafette/estafette-ci-web>https://github.com/estafette/estafette-ci-web</a></td></tr><tr><td><code>estafette-ci-db-migrator</code></td><td>Performs database schema migrations</td><td><a href=https://github.com/estafette/estafette-ci-db-migrator>https://github.com/estafette/estafette-ci-db-migrator</a></td></tr><tr><td><code>estafette-ci-cron-event-sender</code></td><td>Provides a cron event in order to be able to start pipelines with cron triggers</td><td><a href=https://github.com/estafette/estafette-ci-cron-event-sender>https://github.com/estafette/estafette-ci-cron-event-sender</a></td></tr><tr><td><code>estafette-ci-hanging-job-cleaner</code></td><td>Cancels hanging jobs, removes orphaned Kubernetes resources related to builds and releases</td><td><a href=https://github.com/estafette/estafette-ci-hanging-job-cleaner>https://github.com/estafette/estafette-ci-hanging-job-cleaner</a></td></tr></tbody></table><p>When making changes to any of the components references from the subcharts of <code>estafette-ci</code> you can test them in 2 ways:</p><h4 id=override-the-image-tag-in-the-helm-values>Override the image tag in the Helm values</h4><p>Let's say you creating a new build of the <code>estafette-ci-api</code> component. Once it's built succesfully the commit will be tagged with the version number also used for the Docker container. See <a href=https://github.com/estafette/estafette-ci-api/tags>https://github.com/estafette/estafette-ci-api/tags</a> and <a href="https://hub.docker.com/r/estafette/estafette-ci-api/tags?page=1&ordering=last_updated">https://hub.docker.com/r/estafette/estafette-ci-api/tags?page=1&ordering=last_updated</a>.</p><p>Now if you want to test this with an <code>estafette-ci</code> installation you are already running you can set the following values to start using this particular Docker container:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>api:
  image:
    tag: <span style=color:#5a2>&#39;&lt;version number to test&gt;&#39;</span>
</code></pre></div><p>Applying the changes will have your setup start using this particular version of said component.</p><h4 id=update-the-subchart-version-and-build-the-estafette-ci-helm-chart>Update the subchart version and build the estafette-ci Helm chart</h4><p>One step further, but with more automated testing to check whether all components get installed correctly you can update the subchart version.</p><p>For the <code>estafette-ci-api</code> component you would update the subchart version at <a href=https://github.com/estafette/estafette-ci/blob/main/helm/estafette-ci/charts/estafette-ci-api/Chart.yaml#L18>https://github.com/estafette/estafette-ci/blob/main/helm/estafette-ci/charts/estafette-ci-api/Chart.yaml#L18</a> to</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>version: <span style=color:#5a2>&#39;&lt;version number to test&gt;&#39;</span>
</code></pre></div><p>If you commit and push your changes it will do a complete build and tag the repository with the correct build version number, as can be seen at <a href=https://github.com/estafette/estafette-ci/tags>https://github.com/estafette/estafette-ci/tags</a>.</p><p>You can now install this version of the <code>estafette-ci</code> chart to test out your changes.</p><h3 id=releases>Releases</h3><p>When you following the second method of testing changes by updating the <code>version</code> in the subchart for that component, you'll have to do the following to create a new release:</p><ul><li>Create one or multiple issues at <a href=https://github.com/estafette/estafette-ci/issues>https://github.com/estafette/estafette-ci/issues</a> and link them to a milestone with the next version number up for release. You can see the previous milestones/releases at <a href="https://github.com/estafette/estafette-ci/milestones?state=closed">https://github.com/estafette/estafette-ci/milestones?state=closed</a> or <a href=https://github.com/estafette/estafette-ci/releases>https://github.com/estafette/estafette-ci/releases</a>. When creating an issue also set an assignee.</li><li>After having tested and verified all to be resolved issues close each of the issues that are going into the next release</li><li>Create a release branch with the version number of the next milestone/release (for example <code>1.0.29</code>) by running <code>git checkout -b 1.0.29</code> and push with <code>git push origin 1.0.29</code></li><li>Once this has been built succesfully with the version number being equal to the release branch and the milestone (so no <code>-main-***</code> suffix) you can release the build to the <code>release</code> <em>release target</em> in the <code>github.com/estafette/estafette-ci</code> pipeline. This will create the <em>Github release</em> with all the closed issues in the release notes. And it will purge any prior pre-release Helm chart versions. If you're an external contributor ask one of the maintainers to create the release for you.</li><li>To be ready for a next release it's good to bump the version number in <code>.estafette.yaml</code> immediately. Do this by switching to the main branch with <code>git checkout main</code>, updating the <code>version</code> in the <code>.estafette.yaml</code> manifest as shown below. And then commit and push with <code>git commit -am "bump version to 1.0.30" && git push</code>.</li></ul><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>version:
  semver:
    major: <span style=color:#3af>1</span>
    minor: <span style=color:#3af>0</span>
    patch: <span style=color:#3af>30</span>
    labelTemplate: <span style=color:#5a2>&#39;{{branch}}-{{auto}}&#39;</span>
    releaseBranch: <span style=color:#3af>1.0</span><span style=color:#3af>.30</span>
</code></pre></div></article></div><div class=row style=max-width:1024px></div></div><div class="col d-none d-xl-flex border-left toc sticky-top"><ul><li class=section-item><a class="section-item-link ancestor">Table of contents</a><ul><li class=page-item><a href=/development/#introduction title=Introduction class=page-item-link>Introduction</a><li class=page-item><a href=/development/#development title=Development class=page-item-link>Development</a><ul><li class=page-item><a href=/development/#override-the-image-tag-in-the-helm-values title="Override the image tag in the Helm values" class=page-item-link>Override the image tag in the Helm values</a><li class=page-item><a href=/development/#update-the-subchart-version-and-build-the-estafette-ci-helm-chart title="Update the subchart version and build the estafette-ci Helm chart" class=page-item-link>Update the subchart version and build the estafette-ci Helm chart</a></ul><li class=page-item><a href=/development/#releases title=Releases class=page-item-link>Releases</a></ul></li></ul></div></div></div></div></div><nav class="footer nav justify-content-end bg-dark p-2"><a href=https://github.com/estafette/estafette-ci-central target=_blank class="nav-link text-light">Github</a></nav><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script></body></html>