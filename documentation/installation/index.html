<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
  Installation &ndash; Estafette CI/CD
</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://estafette.io/css/estafette.css?1529937691">
  </head>
  <body>
    <div id="header-and-main">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="/">Estafette CI</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            
            
                <a class="nav-item nav-link active" href="/documentation/">Documentation</a>
            
                <a class="nav-item nav-link " href="/blog/">Blog</a>
            
        </div>
    </div>
</nav>
      <div id="main">
        
    <div class="container-fluid">
        <div class="row">
            <div class="col mt-4 mb-4 border-right" style="min-width: 200px; max-width: 200px">
    <ul class="list-unstyled p-1 mt-1 mb-1">
        
        
        <li class="mt-4 mb-4"><a class="text-dark active" href="/documentation/"><strong>Documentation</strong></a>
                
            <ul class="list-unstyled mt-2">
                
                <li><a class="active" href="/documentation/installation/">Installation</a></li>
                
                <li><a class="" href="/documentation/usage/">Usage</a></li>
                
                <li><a class="" href="/documentation/architecture/">Architecture</a></li>
                
            </ul>
            
        </li>
        
        <li class="mt-4 mb-4"><a class="text-dark " href="/blog/"><strong>Blog</strong></a>
            
        </li>
        
    </ul>
</div>


            <div class="col pl-5 pt-4" style="overflow: hidden">
                <h1 class="mb-4">Installation</h1>
                

<h3 id="installing-estafette-ci">Installing Estafette CI</h3>

<p>Prerequisites:</p>

<ul>
<li>install <a href="https://github.com/estafette/estafette-cloudflare-dns">https://github.com/estafette/estafette-cloudflare-dns</a></li>
<li>install <a href="https://github.com/estafette/estafette-letsencrypt-certificate">https://github.com/estafette/estafette-letsencrypt-certificate</a></li>
<li>install <a href="https://github.com/estafette/k8s-cockroachdb">https://github.com/estafette/k8s-cockroachdb</a></li>
</ul>

<p>Configure cluster roles and binding:</p>

<pre><code>curl https://raw.githubusercontent.com/estafette/estafette-ci-api/master/rbac.yaml -o rbac.yaml

export NAMESPACE=estafette
export APP_NAME=estafette-ci-api

kubectl apply -f rbac.yaml
</code></pre>

<p>Install the API:</p>

<pre><code>curl https://raw.githubusercontent.com/estafette/estafette-ci-api/master/kubernetes.yaml -o kubernetes.yaml

export NAMESPACE=estafette
export APP_NAME=estafette-ci-api
export TEAM_NAME=tooling-team
export HOSTNAMES=ci.estafette.io
export CLOUDFLARE_IP_RANGES=103.21.244.0/22, 103.22.200.0/22, 103.31.4.0/22, 104.16.0.0/12, 108.162.192.0/18, 131.0.72.0/22, 141.101.64.0/18, 162.158.0.0/15, 172.64.0.0/13, 173.245.48.0/20, 188.114.96.0/20, 190.93.240.0/20, 197.234.240.0/22, 198.41.128.0/17
export GITHUB_APP_PRIVATE_KEY=
export VERSION=123456
export GO_PIPELINE_LABEL=latest
export CPU_REQUEST=10m
export MEMORY_REQUEST=15Mi
export CPU_LIMIT=200m
export MEMORY_LIMIT=512Mi
export GITHUB_APP_ID=1234
export GITHUB_APP_OAUTH_CLIENT_ID=ab3.myjk4935qfamx8sw
export GITHUB_APP_OAUTH_CLIENT_SECRET=***
export GITHUB_WEBHOOK_SECRET=***
export BITBUCKET_API_KEY=***
export BITBUCKET_APP_OAUTH_KEY=f7mFzNWdFbZ2m54aCb
export BITBUCKET_APP_OAUTH_SECRET=***
export ESTAFETTE_CI_API_KEY=***
export SLACK_APP_CLIENT_ID=1575687846.473375433834
export SLACK_APP_CLIENT_SECRET=***
export SLACK_APP_VERIFICATION_TOKEN=***
export SLACK_APP_OAUTH_ACCESS_TOKEN=***
export SECRET_DECRYPTION_KEY=***
export COCKROACH_DATABASE=estafette_ci_api
export COCKROACH_HOST=cockroachdb-public.estafette.svc.cluster.local
export COCKROACH_INSECURE=true
export COCKROACH_CERTS_DIR=
export COCKROACH_PORT=26257
export COCKROACH_USER=estafette_ci_api
export COCKROACH_PASSWORD=***
export ALLOW_CIDRS=allow 0.0.0.0/0;
export MIN_PODS=3
export MAX_PODS=10
export AUTOSCALE_CPU_TARGET_PERCENTAGE=80

cat kubernetes.yaml | envsubst | kubectl apply -f -
</code></pre>

             </div>
        </div>
    </div>

      </div>
    </div>
    <nav class="footer nav justify-content-end bg-dark p-2">
    <a href="https://github.com/estafette/estafette-ci" target="_blank" class="nav-link text-light">Github</a>
</nav>
  </body>
</html>